<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="theme-color" content="#0a0a0f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Day by Day - Your Journal</title>

  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://cdn.quilljs.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">

  <!-- Quill Editor -->
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <div class="dashboard-container">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-content">
        <h1 id="welcome">Day by Day</h1>
        <p id="personalizedMessage" class="personalized-message"></p>
      </div>
      <div class="header-actions">
        <div id="syncStatus"><span class="sync-indicator synced">Synced</span></div>
        <button id="profileBtn" class="icon-btn" onclick="showProfile()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/>
            <path d="M4 20C4 17 8 15 12 15C16 15 20 17 20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Quick Stats - Horizontal Scroll -->
    <div class="stats-container">
      <div class="stat-card">
        <h3 id="entryCount">0</h3>
        <p>Entries</p>
      </div>
      <div class="stat-card">
        <h3 id="streakCount">0</h3>
        <p>Day Streak</p>
      </div>
      <div class="stat-card">
        <h3 id="wordCount">0</h3>
        <p>Words</p>
      </div>
    </div>

    <!-- Friends Section -->
    <div class="friends-section" id="friendsSection">
      <div class="friends-header">
        <h2>Your Friends</h2>
        <a href="connections.html" class="manage-link">Manage</a>
      </div>
      <div class="friends-list" id="friendsList">
        <!-- Friends will be loaded here -->
        <div class="friends-loading">Loading...</div>
      </div>
    </div>

    <!-- New Entry Form with Quill -->
    <div class="entry-form-container" id="entryFormContainer">
      <h2>What's on your mind?</h2>
      <form id="entryForm">
        <input type="text" id="entryTitle" placeholder="Title (optional)" autocomplete="off">
        <div id="editorContainer">
          <div id="editor"></div>
        </div>
        <div class="autosave-indicator" id="autosaveIndicator"></div>
        <div class="form-actions">
          <button type="submit" class="primary-btn" id="saveBtn">Save Entry</button>
          <button type="button" class="secondary-btn" onclick="clearForm()">Clear</button>
        </div>
      </form>
    </div>

    <!-- Shared With Me Section -->
    <div class="entries-container shared-section" id="sharedWithMeSection" style="display: none;">
      <h2>
        <span>Shared with You</span>
        <span class="unread-badge" id="sharedUnreadBadge" style="display: none;">0</span>
      </h2>
      <div id="sharedEntries" class="entries-grid"></div>
    </div>

    <!-- Journal Entries -->
    <div class="entries-container">
      <h2>Your Journal</h2>
      <div id="entries" class="entries-grid"></div>
    </div>
  </div>

  <!-- Floating Action Button -->
  <button class="fab" id="fabNewEntry" onclick="scrollToForm()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
    </svg>
  </button>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="dashboard.html" class="nav-item active">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M19 21H5C4.45 21 4 20.55 4 20V11L12 3L20 11V20C20 20.55 19.55 21 19 21Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        <path d="M9 21V14H15V21" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
      </svg>
      <span>Home</span>
    </a>
    <a href="feed.html" class="nav-item">
      <svg viewBox="0 0 24 24" fill="none">
        <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
        <path d="M3 9H21" stroke="currentColor" stroke-width="2"/>
        <path d="M9 21V9" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span>Feed</span>
    </a>
    <a href="leaderboard.html" class="nav-item">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M12 15C15.866 15 19 11.866 19 8V3H5V8C5 11.866 8.13401 15 12 15Z" stroke="currentColor" stroke-width="2"/>
        <path d="M12 15V18" stroke="currentColor" stroke-width="2"/>
        <path d="M8 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Streaks</span>
    </a>
    <a href="connections.html" class="nav-item" id="navConnections">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M17 21V19C17 16.79 15.21 15 13 15H5C2.79 15 1 16.79 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
        <path d="M23 21V19C22.9986 18.1137 22.7 17.2528 22.1461 16.5523C21.5921 15.8519 20.8165 15.3516 19.95 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M16 3.13C16.8604 3.35031 17.6318 3.84851 18.1837 4.54546C18.7357 5.24241 19.0361 6.09941 19.0361 6.98" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Friends</span>
      <span class="nav-badge" id="navPendingBadge" style="display:none;">0</span>
    </a>
  </nav>

  <!-- Profile Modal -->
  <div id="profileModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Your Profile</h2>
        <button class="close-btn" onclick="hideProfile()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="profileContent"></div>

        <!-- Phone Verification Section -->
        <div class="phone-verification-section">
          <h3>Phone Notifications</h3>
          <p class="section-desc">Verify your phone to get notified when friends share journals with you.</p>
          <div id="phoneStatus"></div>
          <div id="phoneForm" style="display: none;">
            <input type="tel" id="phoneInput" placeholder="(555) 123-4567" maxlength="14">
            <button onclick="sendPhoneCode()" class="primary-btn" id="sendCodeBtn">Send Code</button>
          </div>
          <div id="verifyForm" style="display: none;">
            <input type="text" id="verifyCodeInput" placeholder="6-digit code" maxlength="6" pattern="[0-9]*" inputmode="numeric">
            <button onclick="verifyPhoneCode()" class="primary-btn">Verify</button>
          </div>
        </div>

        <div class="modal-actions">
          <button onclick="editProfile()" class="primary-btn">Edit Profile</button>
          <button onclick="hideProfile()" class="secondary-btn">Close</button>
        </div>

        <!-- Danger Zone -->
        <div class="danger-zone">
          <h3>Danger Zone</h3>
          <p class="danger-desc">Permanently delete your account and all data. This cannot be undone.</p>
          <button onclick="showDeleteAccountModal()" class="danger-btn">Delete Account</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation Modal -->
  <div id="logoutModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Sign Out</h2>
        <button class="close-btn" onclick="hideLogoutModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 16px;">Are you sure you want to sign out?</p>
        <div id="logoutWarning" style="display: none; background: rgba(244, 67, 54, 0.1); border: 1px solid rgba(244, 67, 54, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 16px; color: #f44336; font-size: 0.9rem;"></div>
        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; margin-bottom: 20px; cursor: pointer;">
          <input type="checkbox" id="clearDataCheckbox" style="width: 18px; height: 18px; cursor: pointer;">
          <span>Clear local data (entries will still be saved in the cloud)</span>
        </label>
        <div class="modal-actions">
          <button onclick="hideLogoutModal()" class="secondary-btn">Cancel</button>
          <button onclick="confirmLogout()" class="primary-btn" id="confirmLogoutBtn">Sign Out</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Account Confirmation Modal -->
  <div id="deleteAccountModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Delete Account</h2>
        <button class="close-btn" onclick="hideDeleteAccountModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="delete-warning">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            <line x1="12" y1="9" x2="12" y2="13"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
          </svg>
          <h3>Are you sure?</h3>
          <p>This will permanently delete:</p>
          <ul>
            <li>All your journal entries</li>
            <li>Your connections with friends</li>
            <li>All shared entries</li>
            <li>Your account and profile</li>
          </ul>
          <p><strong>This action cannot be undone.</strong></p>
        </div>
        <div class="modal-actions">
          <button onclick="hideDeleteAccountModal()" class="secondary-btn">Cancel</button>
          <button onclick="deleteAccount()" class="danger-btn" id="confirmDeleteBtn">Delete My Account</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Share With Connections Modal -->
  <div id="shareModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Share with Friends</h2>
        <button class="close-btn" onclick="hideShareModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p class="share-desc">Select friends to share this entry with. They'll get a notification!</p>
        <div id="connectionsList" class="connections-select"></div>
        <div class="modal-actions">
          <button onclick="confirmShare()" class="primary-btn" id="confirmShareBtn">Share</button>
          <button onclick="hideShareModal()" class="secondary-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer"></div>

  <!-- Placeholder functions while module loads -->
  <script>
    window.showProfile = window.hideProfile = window.editProfile =
    window.signOutUser = window.clearForm = window.deleteEntry =
    window.scrollToForm = function() {
      console.log('Please wait, loading...');
    };
  </script>

  <!-- Quill Editor -->
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

  <!-- Hammer.js for gestures -->
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>

  <!-- Dashboard Logic -->
  <script type="module" src="dashboard.js"></script>
</body>
</html>
